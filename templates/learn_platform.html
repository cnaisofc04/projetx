
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apprendre {{ platform_name }} - API Academy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
    <style>
        body {
            background: #f8f9fa;
        }
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 280px;
            background: #2c3e50;
            color: white;
            padding: 20px;
            overflow-y: auto;
        }
        .content {
            margin-left: 280px;
            padding: 40px;
        }
        .step-card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
        }
        .result-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        pre { background: #1e1e1e; padding: 20px; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h4>üìö {{ platform_name }}</h4>
        <hr style="border-color: rgba(255,255,255,0.2)">
        <div id="steps-nav"></div>
        <hr style="border-color: rgba(255,255,255,0.2)">
        <a href="/" style="color: white; text-decoration: none;">‚Üê Retour √† l'accueil</a>
    </div>

    <div class="content">
        <h1>{{ platform_name }}</h1>
        <p class="lead">{{ platform_description }}</p>

        <div id="steps-container"></div>

        <div class="step-card">
            <h3>üîë Configuration de votre cl√© API</h3>
            <p>Pour utiliser {{ platform_name }}, vous avez besoin d'une cl√© API. Voici comment l'obtenir :</p>
            <ol id="api-steps"></ol>
            <div class="alert alert-info">
                <strong>üí° Astuce :</strong> Une fois votre cl√© obtenue, utilisez notre <a href="/secrets-manager">Gestionnaire de Secrets</a> pour la stocker en toute s√©curit√©.
            </div>
        </div>

        <div class="step-card">
            <h3>üß™ Testez en direct</h3>
            <p>Entrez votre cl√© API pour tester la connexion :</p>
            <input type="password" class="form-control mb-3" id="apiKey" placeholder="Collez votre cl√© API ici">
            <button class="test-button" onclick="testConnection()">Tester la connexion</button>
            <div id="testResult" class="result-box"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();

        const platformData = {{ platform_data|tojson }};

        function loadSteps() {
            const stepsNav = document.getElementById('steps-nav');
            const stepsContainer = document.getElementById('steps-container');
            
            platformData.steps.forEach((step, index) => {
                // Navigation
                const navItem = document.createElement('div');
                navItem.innerHTML = `<a href="#step-${index}" style="color: white; text-decoration: none; display: block; padding: 8px 0;">${index + 1}. ${step.title}</a>`;
                stepsNav.appendChild(navItem);

                // Content
                const stepCard = document.createElement('div');
                stepCard.className = 'step-card';
                stepCard.id = `step-${index}`;
                stepCard.innerHTML = `
                    <h3>${index + 1}. ${step.title}</h3>
                    <p>${step.description}</p>
                    <pre><code class="language-python">${step.code}</code></pre>
                    ${step.try_it ? '<button class="test-button" onclick="runExample(' + index + ')">‚ñ∂Ô∏è Essayer ce code</button>' : ''}
                `;
                stepsContainer.appendChild(stepCard);
            });

            // API acquisition steps
            const apiSteps = document.getElementById('api-steps');
            platformData.api_acquisition.forEach(step => {
                const li = document.createElement('li');
                li.innerHTML = step;
                apiSteps.appendChild(li);
            });
        }

        async function testConnection() {
            const apiKey = document.getElementById('apiKey').value;
            const resultBox = document.getElementById('testResult');
            
            if (!apiKey) {
                resultBox.className = 'result-box error';
                resultBox.innerHTML = '‚ö†Ô∏è Veuillez entrer une cl√© API';
                resultBox.style.display = 'block';
                return;
            }

            resultBox.innerHTML = '‚è≥ Test en cours...';
            resultBox.className = 'result-box';
            resultBox.style.display = 'block';

            try {
                const response = await fetch('/api/test-platform', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        platform: '{{ platform_id }}',
                        api_key: apiKey
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    resultBox.className = 'result-box success';
                    resultBox.innerHTML = `‚úÖ Connexion r√©ussie ! ${data.message}`;
                } else {
                    resultBox.className = 'result-box error';
                    resultBox.innerHTML = `‚ùå Erreur : ${data.error}`;
                }
            } catch (error) {
                resultBox.className = 'result-box error';
                resultBox.innerHTML = `‚ùå Erreur : ${error.message}`;
            }
        }

        loadSteps();
    </script>
</body>
</html>
